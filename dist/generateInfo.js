"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,i,s,c){return new(s=s||Promise)(function(t,n){function r(e){try{o(c.next(e))}catch(e){n(e)}}function a(e){try{o(c.throw(e))}catch(e){n(e)}}function o(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,a)}o((c=c.apply(e,i||[])).next())})},__generator=this&&this.__generator||function(t,r){var a,o,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,(n=i?[2&n[0],i.value]:n)[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=r.call(t,s)}catch(e){n=[6,e],o=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};exports.__esModule=!0,exports.generateInfo=void 0;var configObject,promises_1=require("fs/promises"),path=require("path"),parser_enum_1=require("./enum/parser.enum"),read_local_file_1=require("./helper/read-local-file");function generateInfo(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=buildObject(t),[4,promises_1.writeFile("./_cloudcannon/info.json",JSON.stringify(n,null,2))];case 1:return e.sent(),[2]}})})}function buildObject(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return[4,basicGeneratedInfo()];case 1:return n=e.sent(),[4,getCollections(t.loader,t.collections)];case 2:return e.sent(),[2,configObject=__assign(__assign({},t),n)]}})})}function basicGeneratedInfo(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return[4,read_local_file_1.readLocalJSONFile("../package.json")];case 1:return n=e.sent(),[2,{time:(new Date).toISOString(),cloudcannon:{name:n.name,version:n.version}}]}})})}function getCollections(o,i){return void 0===i&&(i={}),__awaiter(this,void 0,void 0,function(){var t,n,r,a;return __generator(this,function(e){switch(e.label){case 0:a=Object.keys(i),t={},n=function(r){var n;return __generator(this,function(e){switch(e.label){case 0:n=void 0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,promises_1.readdir(path.join(".",i[r].path))];case 2:return n=e.sent(),t[r]=n.map(function(e){var n=path.join(".",i[r].path,e),t=path.extname(n),e=getLoaderType(t,o);return{path:n,collection:r,ext:t,loader:e}}),[3,4];case 3:return n=e.sent(),console.log("error",n),[3,4];case 4:return[2]}})},r=0,a=a,e.label=1;case 1:return r<a.length?(a=a[r],[5,n(a)]):[3,4];case 2:e.sent(),e.label=3;case 3:return r++,[3,1];case 4:return[2,t]}})})}function getLoaderType(e,n){e=e.substring(1);n&&console.log(parser_enum_1.ParsersEnum.parse(n[e]))}exports.generateInfo=generateInfo;
//# sourceMappingURL=generateInfo.js.map
